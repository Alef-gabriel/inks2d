{"version":3,"sources":["../src/graphics/Sprite.ts","../src/graphics/Spritemap.ts"],"names":["Sprite","DisplayObject","source","frameNumber","ctx","Spritemap","frameWidth","frameHeight","value","name","frames","speed","loop","frameList","framesType","beginEndFrames","begin","end","i","elapsed"],"mappings":"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","sourcesContent":["import { DisplayObject } from \"DisplayObject\";\n\nexport class Sprite extends DisplayObject {\n\tprivate _currentFrame: number = 0;\n\tprivate _source: any;\n\tprivate _sourceX: number = 0;\n\tprivate _sourceY: number = 0;\n\tprivate _sourceWidth: number = 0;\n\tprivate _sourceHeight: number = 0;\n\tprivate _tilesetFrame: Record<string, any> = {};\n\n\tconstructor(source: any) {\n\t\tsuper();\n\n\t\tif (source instanceof Image) {\n\t\t\tthis.createFromImage(source);\n\t\t} else if (source.frame) {\n\t\t\tthis.createFromAtlas(source); // JSON\n\t\t} else if (source.image && !source.data) {\n\t\t\tthis.createFromTileset(source);\n\t\t} else if (source.image && source.data) {\n\t\t\tthis.createFromTilesetFrames(source);\n\t\t} else if (source instanceof Array) {\n\t\t\tif (source[0] && source[0].source) {\n\t\t\t\tthis.createFromAtlasFrames(source);\n\t\t\t} else if (source[0] instanceof Image) {\n\t\t\t\tthis.createFromImages(source);\n\t\t\t} else {\n\t\t\t\tthrow new Error(\n\t\t\t\t\t`The Image sources in ${JSON.stringify(source)} are not recognized`,\n\t\t\t\t);\n\t\t\t}\n\t\t} else {\n\t\t\tthrow new Error(\n\t\t\t\t`The image source ${JSON.stringify(source)} is not recognized`,\n\t\t\t);\n\t\t}\n\t}\n\n\tget currentFrame(): number {\n\t\treturn this._currentFrame;\n\t}\n\n\tprivate createFromImage(source: any): void {\n\t\tif (!(source instanceof Image)) {\n\t\t\tthrow new Error(`source is not an image object`);\n\t\t} else {\n\t\t\tthis._source = source;\n\t\t\tthis._sourceX = 0;\n\t\t\tthis._sourceY = 0;\n\t\t\tthis.width = source.width;\n\t\t\tthis.height = source.height;\n\t\t\tthis._sourceWidth = source.width;\n\t\t\tthis._sourceHeight = source.height;\n\t\t}\n\t}\n\n\tprivate createFromAtlas(source: any): void {\n\t\tthis._tilesetFrame = source;\n\t\tthis._source = this._tilesetFrame.source;\n\t\tthis._sourceX = this._tilesetFrame.frame.x;\n\t\tthis._sourceY = this._tilesetFrame.frame.y;\n\t\tthis.width = this._tilesetFrame.frame.w;\n\t\tthis.height = this._tilesetFrame.frame.h;\n\t\tthis._sourceWidth = this._tilesetFrame.frame.w;\n\t\tthis._sourceHeight = this._tilesetFrame.frame.h;\n\t}\n\n\tprivate createFromTileset(source: any): void {\n\t\tif (!(source.image instanceof Image)) {\n\t\t\tthrow new Error(`source.image is not an image object`);\n\t\t} else {\n\t\t\tthis._source = source.image;\n\t\t\tthis._sourceX = source.x;\n\t\t\tthis._sourceY = source.y;\n\t\t\tthis.width = source.width;\n\t\t\tthis.height = source.height;\n\t\t\tthis._sourceWidth = source.width;\n\t\t\tthis._sourceHeight = source.height;\n\t\t}\n\t}\n\n\tprivate createFromTilesetFrames(source: any): void {\n\t\tif (!(source.image instanceof Image)) {\n\t\t\tthrow new Error(`source.image is not an image object`);\n\t\t} else {\n\t\t\tthis._source = source.image;\n\t\t\tthis.frames = source.data;\n\n\t\t\tthis._sourceX = this.frames[0][0];\n\t\t\tthis._sourceY = this.frames[0][1];\n\t\t\tthis.width = source.width;\n\t\t\tthis.height = source.height;\n\t\t\tthis._sourceWidth = source.width;\n\t\t\tthis._sourceHeight = source.height;\n\t\t}\n\t}\n\n\tprivate createFromAtlasFrames(source: any): void {\n\t\tthis.frames = source;\n\t\tthis._source = source[0].source;\n\t\tthis._sourceX = source[0].frame.x;\n\t\tthis._sourceY = source[0].frame.y;\n\t\tthis.width = source[0].frame.w;\n\t\tthis.height = source[0].frame.h;\n\t\tthis._sourceWidth = source[0].frame.w;\n\t\tthis._sourceHeight = source[0].frame.h;\n\t}\n\n\tprivate createFromImages(source: any): void {\n\t\tthis.frames = source;\n\t\tthis._source = source[0];\n\t\tthis._sourceX = 0;\n\t\tthis._sourceY = 0;\n\t\tthis.width = source[0].width;\n\t\tthis.height = source[0].height;\n\t\tthis._sourceWidth = source[0].width;\n\t\tthis._sourceHeight = source[0].height;\n\t}\n\n\tgotoAndStop(frameNumber: number): void {\n\t\tif (this.frames.length === 0) return;\n\n\t\tif (this.frames.length > 0 && frameNumber < this.frames.length) {\n\t\t\tif (this.frames[0] instanceof Array) {\n\t\t\t\tthis._sourceX = this.frames[frameNumber][0];\n\t\t\t\tthis._sourceY = this.frames[frameNumber][1];\n\t\t\t} else if (this.frames[frameNumber].frame) {\n\t\t\t\tthis._sourceX = this.frames[frameNumber].frame.x;\n\t\t\t\tthis._sourceY = this.frames[frameNumber].frame.y;\n\n\t\t\t\tthis._sourceWidth = this.frames[frameNumber].frame.w;\n\t\t\t\tthis._sourceHeight = this.frames[frameNumber].frame.h;\n\n\t\t\t\tthis.width = this.frames[frameNumber].frame.w;\n\t\t\t\tthis.height = this.frames[frameNumber].frame.h;\n\t\t\t} else {\n\t\t\t\tthis._source = this.frames[frameNumber];\n\n\t\t\t\tthis._sourceX = 0;\n\t\t\t\tthis._sourceY = 0;\n\n\t\t\t\tthis.width = this._source.width;\n\t\t\t\tthis.height = this._source.height;\n\n\t\t\t\tthis._sourceWidth = this._source.width;\n\t\t\t\tthis._sourceHeight = this._source.height;\n\t\t\t}\n\n\t\t\tthis._currentFrame = frameNumber;\n\t\t\treturn;\n\t\t}\n\n\t\tthrow new Error(`Frame number ${frameNumber} does not exist`);\n\t}\n\n\trender(ctx: CanvasRenderingContext2D): void {\n\t\tctx.drawImage(\n\t\t\tthis._source,\n\t\t\tthis._sourceX,\n\t\t\tthis._sourceY,\n\t\t\tthis._sourceWidth,\n\t\t\tthis._sourceHeight,\n\t\t\t-this.width * this.pivot.x,\n\t\t\t-this.height * this.pivot.y,\n\t\t\tthis.width,\n\t\t\tthis.height,\n\t\t);\n\t}\n}\n","import { DisplayObject } from \"DisplayObject\";\n\ntype Animation = Record<\n\tstring,\n\t{\n\t\tframes: number[];\n\t\tspeed: number;\n\t\tloop: boolean;\n\t}\n>;\n\nexport class Spritemap extends DisplayObject {\n\tprivate readonly _framesPerRow: number;\n\tprivate _frames: number[] = [];\n\tprivate _loop: boolean = true;\n\tprivate _speed: number = 0;\n\tprivate _currentFrame: number = 0;\n\tprivate _currentAnim: string = \"\";\n\tprivate _frameInAnim: number = 0;\n\tprivate _complete: boolean = false;\n\tprivate _playing: boolean = false;\n\n\tprivate _animations: Animation = {};\n\tprivate readonly _source: any;\n\tprivate _sourceX: number = 0;\n\tprivate _sourceY: number = 0;\n\tprivate readonly _sourceWidth: number;\n\tprivate readonly _sourceHeight: number;\n\n\tprivate _elapsed: number = 0;\n\n\tpublic onAnimStart?: (currentAnim: string, currentFrame: number) => void;\n\tpublic onAnimUpdate?: (currentAnim: string, currentFrame: number) => void;\n\tpublic onAnimComplete?: (currentAnim: string, currentFrame: number) => void;\n\n\tconstructor(source: any, frameWidth: number, frameHeight: number) {\n\t\tsuper();\n\n\t\tthis._source = source;\n\t\tthis._framesPerRow = this._source.width / frameWidth;\n\t\tthis._sourceWidth = frameWidth;\n\t\tthis._sourceHeight = frameHeight;\n\n\t\tthis.width = frameWidth;\n\t\tthis.height = frameHeight;\n\n\t\tthis.bounds.width = this.width;\n\t\tthis.bounds.height = this.height;\n\t}\n\n\tget complete(): boolean {\n\t\treturn this._complete;\n\t}\n\n\tget animationName(): string {\n\t\treturn this._currentAnim;\n\t}\n\n\tget frame(): number {\n\t\treturn this._currentFrame;\n\t}\n\n\tset frame(value: number) {\n\t\tthis._sourceX = Math.floor(value % this._framesPerRow) * this._sourceWidth;\n\t\tthis._sourceY = Math.floor(value / this._framesPerRow) * this._sourceHeight;\n\t\tthis._currentFrame = value;\n\t}\n\n\taddAnimation(\n\t\tname: string,\n\t\tframes: string | number | number[],\n\t\tspeed: number,\n\t\tloop: boolean,\n\t): void {\n\t\tlet frameList: number[] = [];\n\t\tconst framesType = typeof frames;\n\n\t\tif (framesType === \"string\") {\n\t\t\tconst beginEndFrames = (frames as string).split(\"-\");\n\t\t\tconst begin = parseInt(beginEndFrames[0]);\n\t\t\tconst end = parseInt(beginEndFrames[1]);\n\n\t\t\tfor (let i = begin; i <= end; i++) frameList.push(i);\n\t\t} else if (framesType === \"object\") {\n\t\t\tframeList = frames as number[];\n\t\t} else if (framesType === \"number\") {\n\t\t\tframeList = [frames as number];\n\t\t}\n\n\t\tthis._animations[name] = {\n\t\t\tframes: frameList,\n\t\t\tspeed,\n\t\t\tloop,\n\t\t};\n\t}\n\n\tplay(name: string): void {\n\t\tif (!this._animations[name]) return;\n\n\t\tthis._frames = this._animations[name].frames;\n\t\tthis._speed = this._animations[name].speed;\n\t\tthis._loop = this._animations[name].loop;\n\t\tthis._currentFrame = this._frames[0];\n\t\tthis._currentAnim = name;\n\t\tthis._frameInAnim = 0;\n\t\tthis._complete = false;\n\t\tthis._playing = true;\n\n\t\tif (this.onAnimStart != null)\n\t\t\tthis.onAnimStart(this._currentAnim, this._currentFrame);\n\t}\n\n\tpause(): void {\n\t\tthis._playing = false;\n\t}\n\n\tresume(): void {\n\t\tthis._playing = true;\n\t}\n\n\trender(ctx: CanvasRenderingContext2D): void {\n\t\tthis.updtFrame(this.customProperties.elapsed);\n\n\t\tctx.drawImage(\n\t\t\tthis._source,\n\t\t\tthis._sourceX,\n\t\t\tthis._sourceY,\n\t\t\tthis._sourceWidth,\n\t\t\tthis._sourceHeight,\n\t\t\t-this.width * this.pivot.x,\n\t\t\t-this.height * this.pivot.y,\n\t\t\tthis.width,\n\t\t\tthis.height,\n\t\t);\n\t}\n\n\tprivate updtFrame(elapsed: number): void {\n\t\tif (this._frames.length === 0 || this._complete || !this._playing) return;\n\n\t\tthis._elapsed += elapsed;\n\n\t\tif (this._elapsed >= this._speed) {\n\t\t\tthis.frame = this._frames[this._frameInAnim++];\n\n\t\t\tif (this.onAnimUpdate != null)\n\t\t\t\tthis.onAnimUpdate(this._currentAnim, this._currentFrame);\n\n\t\t\tif (this._frameInAnim >= this._frames.length) {\n\t\t\t\tif (this._loop) {\n\t\t\t\t\tthis._frameInAnim = 0;\n\t\t\t\t} else {\n\t\t\t\t\tthis._complete = true;\n\t\t\t\t\tthis._playing = false;\n\n\t\t\t\t\tif (this.onAnimComplete != null)\n\t\t\t\t\t\tthis.onAnimComplete(this._currentAnim, this._currentFrame);\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tthis._elapsed = 0;\n\t\t}\n\t}\n}\n"]}